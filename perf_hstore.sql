SET max_parallel_workers_per_gather = 0;
CREATE EXTENSION hstore;

-- 10 k/v pairs, 96 byte key, 96 byte value = 1920 data bytes
CREATE TABLE hstore_inline_uncompressed (kv HSTORE NOT NULL);
INSERT INTO hstore_inline_uncompressed (SELECT 'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0=>v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0,k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1=>v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1,k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2=>v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2,k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3=>v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3,k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4=>v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4,k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5=>v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5,k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6=>v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6,k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7=>v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7,k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8=>v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8,k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9=>v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9' FROM generate_series(1, 1000000));
VACUUM ANALYZE hstore_inline_uncompressed;
SELECT substr(kv::text, 0, 30), octet_length(hstore_to_array(kv)::text), pg_column_size(kv), pg_column_size(hstore_inline_uncompressed) FROM hstore_inline_uncompressed LIMIT 1;


SELECT 'hstore_inline_uncompressed found';
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_uncompressed;

SELECT 'hstore_inline_uncompressed not found';
EXPLAIN ANALYZE SELECT kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_uncompressed;

SELECT 'hstore_inline_uncompressed count found';
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_uncompressed;

SELECT 'hstore_inline_uncompressed count not found';
EXPLAIN ANALYZE SELECT COUNT(kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_uncompressed;


-- 10 k/v pairs, 96 byte key, 96 byte value + 1 = 1921 data bytes
-- one byte larger so it ends up compressed
CREATE TABLE hstore_inline_compressed (kv HSTORE NOT NULL);
INSERT INTO hstore_inline_compressed (SELECT 'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0=>v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0v0,k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1=>v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1v1,k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2=>v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2v2,k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3=>v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3v3,k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4=>v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4v4,k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5=>v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5v5,k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6=>v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6v6,k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7=>v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7v7,k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8=>v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8v8,k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9=>v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v9v90' FROM generate_series(1, 1000000));
VACUUM ANALYZE hstore_inline_compressed;
SELECT substr(kv::text, 0, 30), octet_length(hstore_to_array(kv)::text), pg_column_size(kv), pg_column_size(hstore_inline_compressed) FROM hstore_inline_compressed LIMIT 1;

SELECT 'hstore_inline_compressed found';
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_compressed;

SELECT 'hstore_inline_compressed not found';
EXPLAIN ANALYZE SELECT kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_inline_compressed;

SELECT 'hstore_inline_compressed count found';
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_compressed;

SELECT 'hstore_inline_compressed count not found';
EXPLAIN ANALYZE SELECT COUNT(kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'kxk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_inline_compressed;


-- 10 k/v pairs, 96 byte key, 96 byte value + 1 = 1921 data bytes
-- pg_column_size=2005 tuple=2033: uncompressed but stored in a toast page (can't be compressed enough with pglz?)
CREATE TABLE hstore_toast_uncompressed (kv HSTORE NOT NULL);
INSERT INTO hstore_toast_uncompressed (SELECT 'uncompressed_toast_m4M3OUfFqQU3rbuACC59hlevLzLgqe2cHAgR6pZ5aG8KGfQuo5O2LJc0kECJFQq2ZG90HKqnDCxh5T=>LqVFwqOpMyg2zzntSRaUsGrEwbCR5HH0vXZm2XKdtl0Omg6vtfstzzOxzkr0wuQHpG602plP147DdYbmg2paGXnAHDlT5naQ,dtDVcyQ5Zsa5V2EOPe3B6eQ9ZfZTsZkeGUHyqL8W5nDFvT9Eg2nJZtD0w0fkNUruXaA9sM7dSODpBrwN6MY7iPbhRBi6RS3K=>d4esR2sw7r9DnMvaNnsWgOkbOSsjKR5OAMrcsQT7v34QhpdYk9LTWYQ0v7oXoELhVLHwe6p5OTwshUD0ryThV8kb99V0wRB3,L2v5ODvAapsvudOjIukAL9accyKY5evx6woqc3WQpDHuB3xgTd17UJdVHudFfrXknUMB3EJSpPVD7Qoq4MVgL0qB9oWV5dDL=>VzEmnvMfIpmrIA33UAHoAlkp8W2X9MnxAO3eRrKga3Z814HkM6QCh1rb3u3UG7UYm60K5BVuc1XjguvnP4OtETUWjyDzSt0c,AbHKmGiSgGmSNHXYRwprIxQXCeUZdfikmhxvLfgfXQf9qGrjAFNXRCu5U0eb57JvVy4cbYNxVokecQRoVkkxc55yYuRMAW8i=>MmgJuGWOikIBhOK68mDutPxaHFq1J6FEdPk3S5XzSShPOmeTrU5WCEXjsyhcpK6kyZX2J6PeYVaSY7YwreC8k8bWshJYjan5,cjOrolPRszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj=>ZFk0pcQMRoEhlEnKHDwl00ODwOz8Oo6QlOYUK7QOCQLdtrVxGloYY5lDyr1ivP143s1nKVjKSfiShUHSNzRRzHHQYO3gj3ei,kmJ8JuS4KONolm93oUtTXWIdwku9bMoTu09p45TmaBh6TIZ1D8xkm7VzoqdAxIzaS0HQv2M6DGbJkuZSSeTtiExgNwUDuuUn=>jSkrDR1SZ9SPemN8oioDhF31eZj6bynZUmAebgtkUwTQZRzWj3laolgIoPDfKzZ5embKHKSBogjzh8QMFpmDuAMCpMLT9YQN,1aTa2ob42SQnxGptBZ8spAHA3XPHtY3fJLKTm4QJgFTf3uRSH1truaeOTYYwYJL4I18P0nO4DhEU4urrtuKcf35cMgbdgae4=>PJE6dJLDPx8OXtC0MbalC81F8ZHe1xXDeW5da1pgccgjKwkXxFuFK3tQBd8BZSzYM0H4jWB64hE7BVVeXLasrHOLJiJk7tPq,Bi4uRHMCsqY7dGqLj8SoS9cx4IOWeZIUQR8AKozIbTfMZgxezHvkn2PEgJponoqraGaWkgtfzbCnhpZS1pUySsiWuESQuald=>KpghqvFSfAyHbzKrDAbicUQOtcjUDWElVFyhixd9CjRuKfmY5asBS2Pi7W8iSnwuUf2ohXOnsJMgv6Q4IVCbzGxW7HFfSJhz,t3I1oOEIVC2AosNN6gnQ13TQz391YRrvexryWZQAfmsxUSVhocs7QB3au546PVDdlEa5Gn4EFHgiUNhuXHlu5Jj46Uwupo70=>6ejPlvzAhrt70qhDZUbdril5yFd0zcUI9tAOb6hhleNA18YTRNtACRcuYlaV5f45kKvQgcmnESTKaialEJKWfbDMjkxF3JII,iWGbfa1b2FfohOErrVCqxc7FW3IujPKnGALr3jXd88r5zCpAqSjOJixIubTpq20qLAhhziXOxBrLFCoKwIQJsmhmokm8E1fN=>emCvwlpnFkahr0wQyVM2swDKCs3VNtTRurMeKnK3ZuuTKEHBoVY5JbjfMNyTZlxW1Ha0hl0VVDAf9lm9NacDjigG8HOnMTYO' FROM generate_series(1, 1000000));
VACUUM ANALYZE hstore_toast_uncompressed;

SELECT substr(kv::text, 0, 30), octet_length(hstore_to_array(kv)::text), pg_column_size(kv), pg_column_size(hstore_toast_uncompressed) FROM hstore_toast_uncompressed LIMIT 1;

SELECT 'hstore_toast_uncompressed found';
EXPLAIN ANALYZE SELECT kv->'cjOrolPRszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj' FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT kv->'cjOrolPRszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj' FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT kv->'cjOrolPRszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj' FROM hstore_toast_uncompressed;

SELECT 'hstore_toast_uncompressed not found';
EXPLAIN ANALYZE SELECT kv->'notfoundszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj' FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT kv->'notfoundszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj' FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT kv->'notfoundszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj' FROM hstore_toast_uncompressed;

SELECT 'hstore_toast_uncompressed count found';
EXPLAIN ANALYZE SELECT COUNT(kv->'cjOrolPRszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj') FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'cjOrolPRszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj') FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'cjOrolPRszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj') FROM hstore_toast_uncompressed;

SELECT 'hstore_toast_uncompressed count not found';
EXPLAIN ANALYZE SELECT COUNT(kv->'notfoundszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj') FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'notfoundszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj') FROM hstore_toast_uncompressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'notfoundszyeBaSq5CTjMbVlimFF1k3iiPTXLxakiSWRLl8A8UItwDDozJigokapllqgI41sOpmJgzMbgvN7y6E2ehtGOsRj') FROM hstore_toast_uncompressed;


-- this is constructed to be compressed, but JUST too large so it needs to use toast
-- 10 k/v pairs, 96 byte key, 7 with 193 byte values, 1 with 103 byte value, 1 with 96 byte value, 1 with 97 byte value = 2607 data bytes
-- string octet length 2628 pg_column_size 2006 tuple 2034
CREATE TABLE hstore_toast_compressed (kv HSTORE NOT NULL);
INSERT INTO hstore_toast_compressed (SELECT 'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0=>LqVFwqOpMyg2zzntSRaUsGrEwbCR5HH0vXZm2XKdtl0Omg6vtfstzzOxzkr0wuQHpG602plP147DdYbmg2paGXnAHDlT5naQ3SeC2nQHzqM9bZczfalNJJrFXv2xtdzvScfmyuxHvLVJnuNT94lZ2P8qV3BCZB9I5qQKvMcJufsM0fTogjknKwQknXw5UtDfm,k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1k1=>d4esR2sw7r9DnMvaNnsWgOkbOSsjKR5OAMrcsQT7v34QhpdYk9LTWYQ0v7oXoELhVLHwe6p5OTwshUD0ryThV8kb99V0wRB3EGFiHzILYaYCwE0mtPqQ5gQpoFaqR5VhjiTgoXr3KSH5Z5tU4C3O4noGUnYRgvbqu4tXbMM5qd5udztNMoYPsXL1Bu24ZqKLm,k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2k2=>VzEmnvMfIpmrIA33UAHoAlkp8W2X9MnxAO3eRrKga3Z814HkM6QCh1rb3u3UG7UYm60K5BVuc1XjguvnP4OtETUWjyDzSt0cxq2xEZ1isyZeJiuk7BO9LJRWrHTQIw55cFjPpbOcZLRlJx8C3pMSE6jow5kfMGTZmlfkOlzamlj49znIwaANF8VH0D5tC9RCp,k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3k3=>MmgJuGWOikIBhOK68mDutPxaHFq1J6FEdPk3S5XzSShPOmeTrU5WCEXjsyhcpK6kyZX2J6PeYVaSY7YwreC8k8bWshJYjan55FrCMip7ibHr3avmWap4NltmWlZOXKtTqxta6H8FLtfxE2TpYV3iPMubXOr09lJovCYTy45SyjGxXpQEG6mwez7uqne6ZnW8L,k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4k4=>ZFk0pcQMRoEhlEnKHDwl00ODwOz8Oo6QlOYUK7QOCQLdtrVxGloYY5lDyr1ivP143s1nKVjKSfiShUHSNzRRzHHQYO3gj3ei8BnerkJZOhCaNdJvqqs82ICHrt79IU69veCOdSGc3G4DFD2qgEgDcWy6ZTIrgJRcJ5rF6YThm49wINOIcyoFgga8zQN0kZMXw,k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5k5=>jSkrDR1SZ9SPemN8oioDhF31eZj6bynZUmAebgtkUwTQZRzWj3laolgIoPDfKzZ5embKHKSBogjzh8QMFpmDuAMCpMLT9YQN8uN7e9leHODMlsb83bVKjzSILL38eGClpqDbz417TCxMdO71virogbAulOalwqp4h5iKbYNbYh4mm3SxMG5ZBQd5dzlMJ8eEP,k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6k6=>PJE6dJLDPx8OXtC0MbalC81F8ZHe1xXDeW5da1pgccgjKwkXxFuFK3tQBd8BZSzYM0H4jWB64hE7BVVeXLasrHOLJiJk7tPq2a29Ok0VjtxuzLeLHkvd5GJpi3yuPIoxFZiJxXeUy9yYTVU8cm5Tee6IJ3SPqPT0hhd05im9ANz7IkJZLvWACE16qVAdgjor3,k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7k7=>KpghqvFSfAyHbzKrDAbicUQOtcjUDWElVFyhixd9CjRuKfmY5asBS2Pi7W8iSnwuUf2ohXOnsJMgv6Q4IVCbzGxW7HFfSJhzczLOWXQ,k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8k8=>6ejPlvzAhrt70qhDZUbdril5yFd0zcUI9tAOb6hhleNA18YTRNtACRcuYlaV5f45kKvQgcmnESTKaialEJKWfbDMjkxF3JII,k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9k9=>emCvwlpnFkahr0wQyVM2swDKCs3VNtTRurMeKnK3ZuuTKEHBoVY5JbjfMNyTZlxW1Ha0hl0VVDAf9lm9NacDjigG8HOnMTYOZ' FROM generate_series(1, 1000000));
VACUUM ANALYZE hstore_toast_compressed;

SELECT substr(kv::text, 0, 30), octet_length(hstore_to_array(kv)::text), pg_column_size(kv), pg_column_size(hstore_toast_compressed) FROM hstore_toast_compressed LIMIT 1;

SELECT 'hstore_toast_compressed found';
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_toast_compressed;

SELECT 'hstore_toast_compressed not found';
EXPLAIN ANALYZE SELECT kv->'notfoundk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT kv->'notfoundk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT kv->'notfoundk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0' FROM hstore_toast_compressed;

SELECT 'hstore_toast_compressed count found';
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_toast_compressed;

SELECT 'hstore_toast_compressed count not found';
EXPLAIN ANALYZE SELECT COUNT(kv->'notfoundk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'notfoundk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_toast_compressed;
EXPLAIN ANALYZE SELECT COUNT(kv->'notfoundk0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0k0') FROM hstore_toast_compressed;


-- total table size stats
SELECT pg1.oid, pg1.relname, pg1.reltoastrelid, pg1.relpages, pg1.reltuples, pg2.relpages AS toast_pages, pg2.reltuples AS toast_tuples, pg_total_relation_size(pg1.relname::text) AS total_relation_size, pg_size_pretty(pg_total_relation_size(pg1.relname::text)) AS total_relation_size_pretty
FROM pg_class AS pg1, pg_class AS pg2
WHERE pg1.relname NOT LIKE 'pg_%' AND pg1.relname NOT LIKE 'sql_%' and pg1.reltoastrelid = pg2.oid
ORDER BY relname;
